<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" http-equiv="encoding" />

    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.4.0/dist/leaflet.js"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Popper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.4.0/dist/leaflet.css" />

    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css" />
    <link rel="stylesheet"
        href="https://rawcdn.githack.com/python-visualization/folium/master/folium/templates/leaflet.awesome.rotate.css" />

    <link rel="stylesheet" href="./styles1.css">
    <style>
        html,
        body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
    <style>
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            right: 0;
            left: 0;
        }
    </style>

    <meta name="viewport" content="width=device-width,
  initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <style>
        #map_12d7de26b4974ead8909c6eec67871d2 {
            position: relative;
            width: 100.0%;
            height: 100.0%;
            left: 0.0%;
            top: 0.0%;
        }
    </style>


</head>

<body onload="openTab(event, 'First')">

    <div class="tab">
        <button class="tablinks" onclick="openTab(event, 'First')">Map</button>
        <button class="tablinks" onclick="openTab(event, 'Second')">Purchase 2000-2020</button>
        <button class="tablinks" onclick="openTab(event, 'Third')">Median vs Year</button>
        <button class="tablinks" onclick="openTab(event, 'Fourth')">Top 10</button>
        <button class="tablinks" onclick="openTab(event, 'Fifth')">Pie Chart</button>
        <button class="tablinks" onclick="openTab(event, 'Sixth')">Top Colors</button>
        <button class="tablinks" onclick="openTab(event, 'Seventh')">Car Types</button>
        <button class="tablinks" onclick="openTab(event, 'Eighth')">Condition vs Color</button>
    </div>


    <div id="First" class="tabcontent">
        <div id="header" class="container-lg p-4 my-1 bg-primary text-white">
            <h1>Visualization for used cars in USA</h1>
        </div>
        <div id="us-map" class="container-lg">
            <h2>US Map</h2>
            <div id="svg">

            </div>
            <div class="sliderContainer">
                <input type="range" min="2000" max="2021" class="slider" id="yearsRange">
                <p>Year: <span id="displayYear"></span></p>
            </div>
        </div>

        <div id="bar-chart" class="container-lg my-1">
            <h2>Bar Chart</h2>
            <div id="svg-bar">

            </div>
        </div>
    </div>

    <div id="Second" class="tabcontent">
        <img src="./assets/First.png" alt="Trulli" width="900" height="500">
    </div>

    <div id="Third" class="tabcontent">
        <img src="./assets/Second.png" alt="Trulli" width="900" height="500">
    </div>

    <div id="Fourth" class="tabcontent">
        <img src="./assets/Third.png" alt="Trulli" width="900" height="500">
    </div>

    <div id="Fifth" class="tabcontent">
        <img src="./assets/Fourth.png" alt="Trulli" width="900" height="500">
    </div>
     <div id="Sixth" class="tabcontent">
        <img src="./assets/five.jpg" alt="Trulli" width="900" height="500">
    </div>
     <div id="Seventh" class="tabcontent">
        <img src="./assets/six.jpg" alt="Trulli" width="900" height="500">
    </div>
     <div id="Eighth" class="tabcontent">
        <img src="./assets/seven.jpg" alt="Trulli" width="900" height="500">
    </div>



    <!--JAVASCRIPT HERE ONWARDS-->

    <script>
        function openTab(evt, cityName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(cityName).style.display = "block";
            evt.currentTarget.className += " active";
        }
    </script>

    <script type="text/javascript" src="https://d3js.org/d3.v5.min.js"></script>

    <!-- Script for US Map -->
    <script type="text/javascript">


    let m = [-122.490402, 37.786453],
        q = [-122.389809, 31.72728],
        n = [-122.389809, 37.72728];
    let coordinates = [m, n, q];

      function loadMap(points) {



        console.log(points[0]);



        let pathGenerator = null

        let geoJsonUrl = ''
        let aa = [-122.490402, 37.786453],
            bb = [-122.389809, 37.72728];
        let ds = [aa, bb];

        pathGenerator = d3.geoPath().projection(usaProjection)
        geoJsonUrl = "https://gist.githubusercontent.com/spiker830/e0d1b7950ced31369c903bed0cead7b1/raw/702c72e0ca5a1be95f84a50a58cfa6d4d6400f3f/us_features.json"

        d3.json(geoJsonUrl).then(geojson => {
            svg.selectAll("path")
                .data(geojson.features)
                .enter()
                .append("path")
                .attr("d", pathGenerator)
                .attr("stroke", "grey")
                .attr("fill", "white")
                .attr("class", "states")

            let pts = svg.selectAll("circle").data(coordinates);
            pts.enter()
              .append("circle")
              .attr("cx", function(d) {
                return usaProjection(d)[0];
              })
              .attr("cy", function(d) {
                return usaProjection(d)[1];
              })
              .attr("r", "4px")
              .attr("fill", "red")
              .attr("class", "points")

            console.log(coordinates[0]);
        })
      }

      function updateMap() {
        let locs = svg.selectAll("circle").data(coordinates);
        locs.exit().transition().attr("cy", 500).remove();
        locs.enter().append("circle")
        .attr("cx", function(d) {
          if(usaProjection(d) != null) {
            return usaProjection(d)[0];
        }
          return aa[0];
        })
        .attr("cy", function(d) {
          if(usaProjection(d) != null) {
            return usaProjection(d)[1];
        }
          return aa[1];
        })
        .attr("r", "4px")
        .attr("fill", "red")
        .attr("class", "points")
      }

    </script>
    <!--script for slider -->
    <script type="text/javascript">
    let manufacturer = [],
      carYear = [],
      model = [],
      price = [],
      latitude = [],
      longitude = [],
      state = [],
      fullData = [],
      postingDate = [];


    function loadSlider() {
      let slider = document.getElementById("yearsRange");
      let output = document.getElementById("displayYear");
      output.innerHTML = slider.value;

      loadData();

      slider.oninput = function () {
          let selectedYear = this.value;

          output.innerHTML = selectedYear;
          for(let i=0; i<carYear.length; i++) {
            if(carYear[i] === selectedYear) {
              let point = [];
              point.push(parseInt(longitude[i], 10));
              point.push(parseInt(latitude[i], 10));
              coordinates.push(point);


              //console.log(coordinates[i]);
            }
          }
          updateMap();
          //d3.selectAll(".mapusa").remove();
          //loadMap(coordinates);
          //console.log(manufacturer[selectedYear]);
      }
    }

    function loadData() {
      try {
        d3.csv("./data/vehicles.csv").then(function(data) {
          fullData = data;
          data.map(function(d) {
            //fullData.push(d);
            manufacturer.push(d.manufacturer);
            carYear.push(d.year);
            model.push(d.model);
            price.push(d.price);
            latitude.push(d.lat);
            longitude.push(d.long);
            postingDate.push(d.posting_date);
            state.push(d.state);
          });
        });
      } catch (e) {
        console.log("ERROR");
      }
    }
    </script>

    <!-- script for bar chart -->
    <script type="text/javascript">

    </script>

    <!-- Driver code -->
    <script type="text/javascript">
    let usaProjection = d3.geoAlbersUsa()
        .scale(850)
        .translate([550, 250]);
    let aa = [-85.48, 32.59],
        bb = [-122.389809, 37.72728];
      let ds = [aa, bb];
      let width = 900, height = 500;
      let svg = d3.select("#svg").append("svg")
          .attr("width", width)
          .attr("height", height)
          .attr("class", "mapusa")
      loadSlider();
      loadMap(ds);
    </script>
</body>

</html>
